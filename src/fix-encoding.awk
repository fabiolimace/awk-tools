#!/usr/bin/gawk -f
# 
# Fixes text originally encoded to UT-8 misunderstood as ISO-88591/Windows-1252 and then saved as UTF-8
#
# Usage:
#
#     for i in `find folder/ -type f -name "*.txt"`; do ./fix-encoding.awk "$i" > "$i.tmp"; mv "$i.tmp" "$i"; done;
# 
# References:
# *   https://en.wikipedia.org/wiki/Windows-1252
# *   https://en.wikipedia.org/wiki/ISO/IEC_8859-1
#

{
	gsub("â‚¬", "€", $0);	# win1252:"0x80" unicode:"U+20AC" utf8:"0xE2 0x82 0xAC"
	# win1252:"0x81" unicode:"" utf8:""
	gsub("â€š", "‚", $0);	# win1252:"0x82" unicode:"U+201A" utf8:"0xE2 0x80 0x9A"
	gsub("Æ’", "ƒ", $0);	# win1252:"0x83" unicode:"U+0192" utf8:"0xC6 0x92"
	gsub("â€ž", "„", $0);	# win1252:"0x84" unicode:"U+201E" utf8:"0xE2 0x80 0x9E"
	gsub("â€¦", "…", $0);	# win1252:"0x85" unicode:"U+2026" utf8:"0xE2 0x80 0xA6"
	gsub("â€\xA0","†",$0);	# win1252:"0x86" unicode:"U+2020" utf8:"0xE2 0x80 0xA0"
	gsub("â€¡", "‡", $0);	# win1252:"0x87" unicode:"U+2021" utf8:"0xE2 0x80 0xA1"
	gsub("Ë†", "ˆ", $0);	# win1252:"0x88" unicode:"U+02C6" utf8:"0xCB 0x86"
	gsub("â€°", "‰", $0);	# win1252:"0x89" unicode:"U+2030" utf8:"0xE2 0x80 0xB0"
	gsub("Å\xA0","Š",$0);	# win1252:"0x8A" unicode:"U+0160" utf8:"0xC5 0xA0"
	gsub("â€¹", "‹", $0);	# win1252:"0x8B" unicode:"U+2039" utf8:"0xE2 0x80 0xB9"
	gsub("Å’", "Œ", $0);	# win1252:"0x8C" unicode:"U+0152" utf8:"0xC5 0x92"
	# win1252:"0x8D" unicode:"" utf8:""
	gsub("Å½", "Ž", $0);	# win1252:"0x8E" unicode:"U+017D" utf8:"0xC5 0xBD"
	# win1252:"0x8F" unicode:"" utf8:""
	# win1252:"0x90" unicode:"" utf8:""
	gsub("â€˜", "‘", $0);	# win1252:"0x91" unicode:"U+2018" utf8:"0xE2 0x80 0x98"
	gsub("â€™", "’", $0);	# win1252:"0x92" unicode:"U+2019" utf8:"0xE2 0x80 0x99"
	gsub("â€œ", "“", $0);	# win1252:"0x93" unicode:"U+201C" utf8:"0xE2 0x80 0x9C"
	gsub("â€\x9D","”",$0);	# win1252:"0x94" unicode:"U+201D" utf8:"0xE2 0x80 0x9D"
	gsub("â€¢", "•", $0);	# win1252:"0x95" unicode:"U+2022" utf8:"0xE2 0x80 0xA2"
	gsub("â€“", "–", $0);	# win1252:"0x96" unicode:"U+2013" utf8:"0xE2 0x80 0x93"
	gsub("â€”", "—", $0);	# win1252:"0x97" unicode:"U+2014" utf8:"0xE2 0x80 0x94"
	gsub("Ëœ", "˜", $0);	# win1252:"0x98" unicode:"U+02DC" utf8:"0xCB 0x9C"
	gsub("â„¢", "™", $0);	# win1252:"0x99" unicode:"U+2122" utf8:"0xE2 0x84 0xA2"
	gsub("Å¡", "š", $0);	# win1252:"0x9A" unicode:"U+0161" utf8:"0xC5 0xA1"
	gsub("â€º", "›", $0);	# win1252:"0x9B" unicode:"U+203A" utf8:"0xE2 0x80 0xBA"
	gsub("Å“", "œ", $0);	# win1252:"0x9C" unicode:"U+0153" utf8:"0xC5 0x93"
	# win1252:"0x9D" unicode:"" utf8:""
	gsub("Å¾", "ž", $0);	# win1252:"0x9E" unicode:"U+017E" utf8:"0xC5 0xBE"
	gsub("Å¸", "Ÿ", $0);	# win1252:"0x9F" unicode:"U+0178" utf8:"0xC5 0xB8"
	gsub("Â\xA0"," ",$0);	# win1252:"0xA0" unicode:"U+00A0" utf8:"0xC2 0xA0"
	gsub("Â¡", "¡", $0);	# win1252:"0xA1" unicode:"U+00A1" utf8:"0xC2 0xA1"
	gsub("Â¢", "¢", $0);	# win1252:"0xA2" unicode:"U+00A2" utf8:"0xC2 0xA2"
	gsub("Â£", "£", $0);	# win1252:"0xA3" unicode:"U+00A3" utf8:"0xC2 0xA3"
	gsub("Â¤", "¤", $0);	# win1252:"0xA4" unicode:"U+00A4" utf8:"0xC2 0xA4"
	gsub("Â¥", "¥", $0);	# win1252:"0xA5" unicode:"U+00A5" utf8:"0xC2 0xA5"
	gsub("Â¦", "¦", $0);	# win1252:"0xA6" unicode:"U+00A6" utf8:"0xC2 0xA6"
	gsub("Â§", "§", $0);	# win1252:"0xA7" unicode:"U+00A7" utf8:"0xC2 0xA7"
	gsub("Â¨", "¨", $0);	# win1252:"0xA8" unicode:"U+00A8" utf8:"0xC2 0xA8"
	gsub("Â©", "©", $0);	# win1252:"0xA9" unicode:"U+00A9" utf8:"0xC2 0xA9"
	gsub("Âª", "ª", $0);	# win1252:"0xAA" unicode:"U+00AA" utf8:"0xC2 0xAA"
	gsub("Â«", "«", $0);	# win1252:"0xAB" unicode:"U+00AB" utf8:"0xC2 0xAB"
	gsub("Â¬", "¬", $0);	# win1252:"0xAC" unicode:"U+00AC" utf8:"0xC2 0xAC"
	gsub("Â­\xAD","­",$0);	# win1252:"0xAD" unicode:"U+00AD" utf8:"0xC2 0xAD"
	gsub("Â®", "®", $0);	# win1252:"0xAE" unicode:"U+00AE" utf8:"0xC2 0xAE"
	gsub("Â¯", "¯", $0);	# win1252:"0xAF" unicode:"U+00AF" utf8:"0xC2 0xAF"
	gsub("Â°", "°", $0);	# win1252:"0xB0" unicode:"U+00B0" utf8:"0xC2 0xB0"
	gsub("Â±", "±", $0);	# win1252:"0xB1" unicode:"U+00B1" utf8:"0xC2 0xB1"
	gsub("Â²", "²", $0);	# win1252:"0xB2" unicode:"U+00B2" utf8:"0xC2 0xB2"
	gsub("Â³", "³", $0);	# win1252:"0xB3" unicode:"U+00B3" utf8:"0xC2 0xB3"
	gsub("Â´", "´", $0);	# win1252:"0xB4" unicode:"U+00B4" utf8:"0xC2 0xB4"
	gsub("Âµ", "µ", $0);	# win1252:"0xB5" unicode:"U+00B5" utf8:"0xC2 0xB5"
	gsub("Â¶", "¶", $0);	# win1252:"0xB6" unicode:"U+00B6" utf8:"0xC2 0xB6"
	gsub("Â·", "·", $0);	# win1252:"0xB7" unicode:"U+00B7" utf8:"0xC2 0xB7"
	gsub("Â¸", "¸", $0);	# win1252:"0xB8" unicode:"U+00B8" utf8:"0xC2 0xB8"
	gsub("Â¹", "¹", $0);	# win1252:"0xB9" unicode:"U+00B9" utf8:"0xC2 0xB9"
	gsub("Âº", "º", $0);	# win1252:"0xBA" unicode:"U+00BA" utf8:"0xC2 0xBA"
	gsub("Â»", "»", $0);	# win1252:"0xBB" unicode:"U+00BB" utf8:"0xC2 0xBB"
	gsub("Â¼", "¼", $0);	# win1252:"0xBC" unicode:"U+00BC" utf8:"0xC2 0xBC"
	gsub("Â½", "½", $0);	# win1252:"0xBD" unicode:"U+00BD" utf8:"0xC2 0xBD"
	gsub("Â¾", "¾", $0);	# win1252:"0xBE" unicode:"U+00BE" utf8:"0xC2 0xBE"
	gsub("Â¿", "¿", $0);	# win1252:"0xBF" unicode:"U+00BF" utf8:"0xC2 0xBF"
	gsub("Ã€", "À", $0);	# win1252:"0xC0" unicode:"U+00C0" utf8:"0xC3 0x80"
	gsub("Ã\x81","Á",$0);	# win1252:"0xC1" unicode:"U+00C1" utf8:"0xC3 0x81"
	gsub("Ã‚", "Â", $0);	# win1252:"0xC2" unicode:"U+00C2" utf8:"0xC3 0x82"
	gsub("Ãƒ", "Ã", $0);	# win1252:"0xC3" unicode:"U+00C3" utf8:"0xC3 0x83"
	gsub("Ã„", "Ä", $0);	# win1252:"0xC4" unicode:"U+00C4" utf8:"0xC3 0x84"
	gsub("Ã…", "Å", $0);	# win1252:"0xC5" unicode:"U+00C5" utf8:"0xC3 0x85"
	gsub("Ã†", "Æ", $0);	# win1252:"0xC6" unicode:"U+00C6" utf8:"0xC3 0x86"
	gsub("Ã‡", "Ç", $0);	# win1252:"0xC7" unicode:"U+00C7" utf8:"0xC3 0x87"
	gsub("Ãˆ", "È", $0);	# win1252:"0xC8" unicode:"U+00C8" utf8:"0xC3 0x88"
	gsub("Ã‰", "É", $0);	# win1252:"0xC9" unicode:"U+00C9" utf8:"0xC3 0x89"
	gsub("ÃŠ", "Ê", $0);	# win1252:"0xCA" unicode:"U+00CA" utf8:"0xC3 0x8A"
	gsub("Ã‹", "Ë", $0);	# win1252:"0xCB" unicode:"U+00CB" utf8:"0xC3 0x8B"
	gsub("ÃŒ", "Ì", $0);	# win1252:"0xCC" unicode:"U+00CC" utf8:"0xC3 0x8C"
	gsub("Ã\x8D","Í",$0);	# win1252:"0xCD" unicode:"U+00CD" utf8:"0xC3 0x8D"
	gsub("ÃŽ", "Î", $0);	# win1252:"0xCE" unicode:"U+00CE" utf8:"0xC3 0x8E"
	gsub("Ã\x8F","Ï",$0);	# win1252:"0xCF" unicode:"U+00CF" utf8:"0xC3 0x8F"
	gsub("Ã\x90","Ð",$0);	# win1252:"0xD0" unicode:"U+00D0" utf8:"0xC3 0x90"
	gsub("Ã‘", "Ñ", $0);	# win1252:"0xD1" unicode:"U+00D1" utf8:"0xC3 0x91"
	gsub("Ã’", "Ò", $0);	# win1252:"0xD2" unicode:"U+00D2" utf8:"0xC3 0x92"
	gsub("Ã“", "Ó", $0);	# win1252:"0xD3" unicode:"U+00D3" utf8:"0xC3 0x93"
	gsub("Ã”", "Ô", $0);	# win1252:"0xD4" unicode:"U+00D4" utf8:"0xC3 0x94"
	gsub("Ã•", "Õ", $0);	# win1252:"0xD5" unicode:"U+00D5" utf8:"0xC3 0x95"
	gsub("Ã–", "Ö", $0);	# win1252:"0xD6" unicode:"U+00D6" utf8:"0xC3 0x96"
	gsub("Ã—", "×", $0);	# win1252:"0xD7" unicode:"U+00D7" utf8:"0xC3 0x97"
	gsub("Ã˜", "Ø", $0);	# win1252:"0xD8" unicode:"U+00D8" utf8:"0xC3 0x98"
	gsub("Ã™", "Ù", $0);	# win1252:"0xD9" unicode:"U+00D9" utf8:"0xC3 0x99"
	
	# TODO: suportar ambos os casos: 'Ãš' (para WIN-1252) e 'Ã\x9A' (para ISO-8859)
	# Exemplo: https://odia.ig.com.br/buzios/2021/10/6265300-ultimo-fim-de-semana-do-degusta-buzios-sera-sem-mascara.html
    gsub("Ãš", "Ú", $0);	# win1252:"0xDA" unicode:"U+00DA" utf8:"0xC3 0x9A"
	gsub("Ã\x9A", "Ú", $0);	# win1252:"0xDA" unicode:"U+00DA" utf8:"0xC3 0x9A"
	
	gsub("Ã›", "Û", $0);	# win1252:"0xDB" unicode:"U+00DB" utf8:"0xC3 0x9B"
	gsub("Ãœ", "Ü", $0);	# win1252:"0xDC" unicode:"U+00DC" utf8:"0xC3 0x9C"
	gsub("Ã\x9D","Ý",$0);	# win1252:"0xDD" unicode:"U+00DD" utf8:"0xC3 0x9D"
	gsub("Ãž", "Þ", $0);	# win1252:"0xDE" unicode:"U+00DE" utf8:"0xC3 0x9E"
	gsub("ÃŸ", "ß", $0);	# win1252:"0xDF" unicode:"U+00DF" utf8:"0xC3 0x9F"
	gsub("Ã\xA0","à",$0);	# win1252:"0xE0" unicode:"U+00E0" utf8:"0xC3 0xA0"
	gsub("Ã¡", "á", $0);	# win1252:"0xE1" unicode:"U+00E1" utf8:"0xC3 0xA1"
	gsub("Ã¢", "â", $0);	# win1252:"0xE2" unicode:"U+00E2" utf8:"0xC3 0xA2"
	gsub("Ã£", "ã", $0);	# win1252:"0xE3" unicode:"U+00E3" utf8:"0xC3 0xA3"
	gsub("Ã¤", "ä", $0);	# win1252:"0xE4" unicode:"U+00E4" utf8:"0xC3 0xA4"
	gsub("Ã¥", "å", $0);	# win1252:"0xE5" unicode:"U+00E5" utf8:"0xC3 0xA5"
	gsub("Ã¦", "æ", $0);	# win1252:"0xE6" unicode:"U+00E6" utf8:"0xC3 0xA6"
	gsub("Ã§", "ç", $0);	# win1252:"0xE7" unicode:"U+00E7" utf8:"0xC3 0xA7"
	gsub("Ã¨", "è", $0);	# win1252:"0xE8" unicode:"U+00E8" utf8:"0xC3 0xA8"
	gsub("Ã©", "é", $0);	# win1252:"0xE9" unicode:"U+00E9" utf8:"0xC3 0xA9"
	gsub("Ãª", "ê", $0);	# win1252:"0xEA" unicode:"U+00EA" utf8:"0xC3 0xAA"
	gsub("Ã«", "ë", $0);	# win1252:"0xEB" unicode:"U+00EB" utf8:"0xC3 0xAB"
	gsub("Ã¬", "ì", $0);	# win1252:"0xEC" unicode:"U+00EC" utf8:"0xC3 0xAC"
	gsub("Ã­\xAD","í",$0);	# win1252:"0xED" unicode:"U+00ED" utf8:"0xC3 0xAD"
	gsub("Ã®", "î", $0);	# win1252:"0xEE" unicode:"U+00EE" utf8:"0xC3 0xAE"
	gsub("Ã¯", "ï", $0);	# win1252:"0xEF" unicode:"U+00EF" utf8:"0xC3 0xAF"
	gsub("Ã°", "ð", $0);	# win1252:"0xF0" unicode:"U+00F0" utf8:"0xC3 0xB0"
	gsub("Ã±", "ñ", $0);	# win1252:"0xF1" unicode:"U+00F1" utf8:"0xC3 0xB1"
	gsub("Ã²", "ò", $0);	# win1252:"0xF2" unicode:"U+00F2" utf8:"0xC3 0xB2"
	gsub("Ã³", "ó", $0);	# win1252:"0xF3" unicode:"U+00F3" utf8:"0xC3 0xB3"
	gsub("Ã´", "ô", $0);	# win1252:"0xF4" unicode:"U+00F4" utf8:"0xC3 0xB4"
	gsub("Ãµ", "õ", $0);	# win1252:"0xF5" unicode:"U+00F5" utf8:"0xC3 0xB5"
	gsub("Ã¶", "ö", $0);	# win1252:"0xF6" unicode:"U+00F6" utf8:"0xC3 0xB6"
	gsub("Ã·", "÷", $0);	# win1252:"0xF7" unicode:"U+00F7" utf8:"0xC3 0xB7"
	gsub("Ã¸", "ø", $0);	# win1252:"0xF8" unicode:"U+00F8" utf8:"0xC3 0xB8"
	gsub("Ã¹", "ù", $0);	# win1252:"0xF9" unicode:"U+00F9" utf8:"0xC3 0xB9"
	gsub("Ãº", "ú", $0);	# win1252:"0xFA" unicode:"U+00FA" utf8:"0xC3 0xBA"
	gsub("Ã»", "û", $0);	# win1252:"0xFB" unicode:"U+00FB" utf8:"0xC3 0xBB"
	gsub("Ã¼", "ü", $0);	# win1252:"0xFC" unicode:"U+00FC" utf8:"0xC3 0xBC"
	gsub("Ã½", "ý", $0);	# win1252:"0xFD" unicode:"U+00FD" utf8:"0xC3 0xBD"
	gsub("Ã¾", "þ", $0);	# win1252:"0xFE" unicode:"U+00FE" utf8:"0xC3 0xBE"
	gsub("Ã¿", "ÿ", $0);	# win1252:"0xFF" unicode:"U+00FF" utf8:"0xC3 0xBF"
	
	print $0;
}

